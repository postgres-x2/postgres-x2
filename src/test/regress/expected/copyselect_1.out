--
-- Test cases for COPY (select) TO
--
create table test1 (id serial, t text);
ERROR:  Postgres-XC does not support SERIAL yet
DETAIL:  The feature is not currently supported
insert into test1 (t) values ('a');
ERROR:  relation "test1" does not exist
LINE 1: insert into test1 (t) values ('a');
                    ^
insert into test1 (t) values ('b');
ERROR:  relation "test1" does not exist
LINE 1: insert into test1 (t) values ('b');
                    ^
insert into test1 (t) values ('c');
ERROR:  relation "test1" does not exist
LINE 1: insert into test1 (t) values ('c');
                    ^
insert into test1 (t) values ('d');
ERROR:  relation "test1" does not exist
LINE 1: insert into test1 (t) values ('d');
                    ^
insert into test1 (t) values ('e');
ERROR:  relation "test1" does not exist
LINE 1: insert into test1 (t) values ('e');
                    ^
create table test2 (id serial, t text);
ERROR:  Postgres-XC does not support SERIAL yet
DETAIL:  The feature is not currently supported
insert into test2 (t) values ('A');
ERROR:  relation "test2" does not exist
LINE 1: insert into test2 (t) values ('A');
                    ^
insert into test2 (t) values ('B');
ERROR:  relation "test2" does not exist
LINE 1: insert into test2 (t) values ('B');
                    ^
insert into test2 (t) values ('C');
ERROR:  relation "test2" does not exist
LINE 1: insert into test2 (t) values ('C');
                    ^
insert into test2 (t) values ('D');
ERROR:  relation "test2" does not exist
LINE 1: insert into test2 (t) values ('D');
                    ^
insert into test2 (t) values ('E');
ERROR:  relation "test2" does not exist
LINE 1: insert into test2 (t) values ('E');
                    ^
create view v_test1
as select 'v_'||t from test1;
ERROR:  relation "test1" does not exist
LINE 2: as select 'v_'||t from test1;
                               ^
--
-- Test COPY table TO
--
copy test1 to stdout;
ERROR:  relation "test1" does not exist
--
-- This should fail
--
copy v_test1 to stdout;
ERROR:  relation "v_test1" does not exist
--
-- Test COPY (select) TO
--
copy (select t from test1 where id=1) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select t from test1 where id=1) to stdout;
                            ^
--
-- Test COPY (select for update) TO
--
copy (select t from test1 where id=3 for update) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select t from test1 where id=3 for update) to stdout;
                            ^
--
-- This should fail
--
copy (select t into temp test3 from test1 where id=3) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select t into temp test3 from test1 where id=3) to std...
                                            ^
--
-- This should fail
--
copy (select * from test1) from stdin;
ERROR:  syntax error at or near "from"
LINE 1: copy (select * from test1) from stdin;
                                   ^
--
-- This should fail
--
copy (select * from test1) (t,id) to stdout;
ERROR:  syntax error at or near "("
LINE 1: copy (select * from test1) (t,id) to stdout;
                                   ^
--
-- Test JOIN
--
copy (select * from test1 join test2 using (id)) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select * from test1 join test2 using (id)) to stdout;
                            ^
--
-- Test UNION SELECT
--
copy (select t from test1 where id = 1 UNION select * from v_test1 ORDER BY 1) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select t from test1 where id = 1 UNION select * from v...
                            ^
--
-- Test subselect
--
copy (select * from (select t from test1 where id = 1 UNION select * from v_test1 ORDER BY 1) t1) to stdout;
ERROR:  relation "test1" does not exist
LINE 1: copy (select * from (select t from test1 where id = 1 UNION ...
                                           ^
--
-- Test headers, CSV and quotes
--
copy (select t from test1 where id = 1) to stdout csv header force quote t;
ERROR:  relation "test1" does not exist
LINE 1: copy (select t from test1 where id = 1) to stdout csv header...
                            ^
--
-- Test psql builtins, plain table
--
\copy test1 to stdout
ERROR:  relation "test1" does not exist
\copy: ERROR:  relation "test1" does not exist
--
-- This should fail
--
\copy v_test1 to stdout
ERROR:  relation "v_test1" does not exist
\copy: ERROR:  relation "v_test1" does not exist
--
-- Test \copy (select ...)
--
\copy (select "id",'id','id""'||t,(id + 1)*id,t,"test1"."t" from test1 where id=3) to stdout
ERROR:  relation "test1" does not exist
LINE 1: ... 'id""' ||t, ( id + 1 ) *id,t, "test1" . "t" from test1 wher...
                                                             ^
\copy: ERROR:  relation "test1" does not exist
LINE 1: ... 'id""' ||t, ( id + 1 ) *id,t, "test1" . "t" from test1 wher...
                                                             ^
--
-- Drop everything
--
drop table test2;
ERROR:  table "test2" does not exist
drop view v_test1;
ERROR:  view "v_test1" does not exist
drop table test1;
ERROR:  table "test1" does not exist
